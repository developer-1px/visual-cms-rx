# 스마트 선택 정책 PRD (Product Requirements Document)

> 지금 정책은 중요하니까 area에 section PRD에 기록해

## 1. 개요

### 1.1 배경
Visual CMS 에디터에서 사용자가 특정 타입의 요소(예: repeat)를 편집하는 도중 실수로 다른 타입의 요소(예: text, icon)를 클릭하면 작업 흐름이 끊어지고 스트레스를 받는 문제가 발생했습니다.

### 1.2 목적
현재 선택된 요소의 타입과 동일한 타입의 요소를 우선적으로 선택하는 "스마트 선택 정책"을 구현하여 사용자의 편집 워크플로우를 자연스럽게 만드는 것이 목표입니다.

## 2. 핵심 정책

### 2.1 스마트 선택 우선순위
1. **현재 선택된 요소 제외**: 자기 자신은 재선택되지 않음
2. **같은 타입 우선 선택**: 현재 선택된 타입과 동일한 타입 우선
3. **폴백 메커니즘**: 같은 타입이 없으면 가장 가까운 요소 선택

### 2.2 적용 범위
- **Selection (클릭)**: 요소 선택 시 적용
- **Hover (마우스 이동)**: 호버 효과 표시 시 적용

## 3. 기술적 구현

### 3.1 순수함수 구조
```typescript
// src/lib/base/dom/smartElementSelection.ts

// 작은 단위의 순수함수들로 구성
- isSameElement(): 두 요소의 동일성 확인
- excludeCurrentElement(): 현재 요소 제외 필터링
- filterByType(): 타입별 요소 필터링
- selectElementWithSmartPolicy(): 메인 선택 로직
- filterSelectableElements(): 선택 가능한 요소 필터링
```

### 3.2 알고리즘
```typescript
function selectElementWithSmartPolicy(
  candidates: SelectableElement[],
  currentSelectedId: string | null
): SelectableElement | undefined {
  // 1. 현재 선택된 요소 제외
  const filteredCandidates = excludeCurrentElement(candidates, currentSelectedElement);
  
  // 2. 같은 타입 우선 선택
  if (currentType) {
    const sameTypeElements = filterByType(filteredCandidates, currentType);
    if (sameTypeElements.length > 0) {
      return sameTypeElements[0];
    }
  }
  
  // 3. 폴백: 가장 가까운 요소
  return filteredCandidates[0];
}
```

## 4. 사용자 시나리오

### 4.1 Repeat 편집 워크플로우
```
현재 상태: Features 섹션의 repeat 카드 선택됨
사용자 행동: 다른 repeat 카드 영역 클릭 (텍스트와 겹치는 부분)
결과: 텍스트가 아닌 repeat 카드가 선택됨 ✓
```

### 4.2 Text 편집 워크플로우
```
현재 상태: 제목 텍스트 선택됨
사용자 행동: 본문 텍스트 클릭
결과: 다른 텍스트 요소가 선택됨 ✓
```

### 4.3 중첩 요소 선택
```
현재 상태: repeat 카드 선택됨
사용자 행동: 같은 카드 내부의 텍스트 클릭
결과: 내부 텍스트가 선택됨 (자기 자신 제외 정책) ✓
```

## 5. UI/UX 세부사항

### 5.1 Hover 효과
- **Text**: CSS 기반 underline (`data-hover="true"` 속성 + CSS)
- **기타 타입**: Overlay element로 border 표시

### 5.2 색상 시스템
```typescript
const typeColors = {
  text: '#0066ff',      // 파란색
  image: '#ff6b6b',     // 빨간색
  icon: '#ff9f43',      // 주황색
  link: '#9b59b6',      // 보라색
  repeat: '#00d2d3',    // 청록색
};
```

## 6. 성능 고려사항

### 6.1 최적화
- DOM 조회 최소화
- 순수함수 사용으로 테스트 가능성 확보
- CSS 기반 hover 효과로 DOM 조작 감소

### 6.2 확장성
- 새로운 타입 추가 시 색상만 추가하면 자동 적용
- 정책 변경 시 순수함수만 수정

## 7. 향후 개선 가능성

### 7.1 단기
- 사용자가 스마트 선택 정책을 켜고 끌 수 있는 설정
- 시각적 피드백 강화 (스마트 선택 적용 시 미묘한 애니메이션)

### 7.2 장기
- 거리 기반 가중치 추가
- 사용 패턴 학습을 통한 개인화
- 세부 타입 구분 (feature-repeat vs solution-repeat)

## 8. 검증 메트릭

### 8.1 정량적 지표
- 잘못된 요소 선택 횟수 감소율
- 작업 완료 시간 단축률
- 선택 정확도 향상률

### 8.2 정성적 지표
- 사용자 만족도
- 작업 흐름의 자연스러움
- 학습 곡선 개선

## 9. 릴리즈 노트

### v1.0.0 (2025-01-10)
- 스마트 선택 정책 최초 구현
- Selection과 Hover에 동일 정책 적용
- 현재 선택된 요소 제외 로직 추가
- CSS 기반 text hover 효과 구현

---

**작성일**: 2025-01-10 18:17:10  
**작성자**: Claude Code Assistant  
**승인자**: [대기중]  
**구현 상태**: 구현 완료 ✓