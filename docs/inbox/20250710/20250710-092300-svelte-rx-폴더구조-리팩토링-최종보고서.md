# svelte-rx 폴더구조 리팩토링 최종 보고서

> 좋아. 지금 내용 폴더 구조 내용 보고서로 작성해

## 개요

svelte-rx 프로젝트의 폴더 구조를 데이터/기능/화면 3계층으로 분리하고, 공유 이벤트를 위한 actions 레이어를 추가하여 의존성을 정리했습니다.

## 최종 폴더 구조

```
src/lib/
├── base/                      # 핵심 인프라
│   ├── dom/                   # DOM 관련 유틸리티
│   └── svelte-rx/            # RxJS 기반 상태 관리 코어
│
├── actions/                   # 공유 이벤트 레이어 (NEW!)
│   ├── editor/               # 에디터 관련 액션
│   │   └── mode.ts          # 모드 변경 액션
│   ├── selection/           # 선택 관련 액션  
│   │   └── index.ts        # 선택, 해제, 크기변경 등
│   └── index.ts            # 전체 액션 재내보내기
│
├── entities/                  # 순수 데이터 모델
│   ├── editor/               # 에디터 데이터
│   │   ├── types.ts         # HtmlNode, TextSelection 타입
│   │   ├── modeStore.ts     # 에디터 모드 상태 관리
│   │   └── index.ts         # 재내보내기
│   ├── selection/           # 선택 영역 데이터
│   │   ├── types.ts         # SelectionPayload 등 타입
│   │   ├── store.ts         # 선택 상태 관리
│   │   └── index.ts         # 재내보내기
│   └── index.ts            # 전체 스키마 정의
│
├── features/                  # 비즈니스 로직
│   └── html-parser/          # HTML 파싱 및 편집 기능
│       ├── parser.ts         # HTML 파싱 로직
│       ├── editorStore.ts    # 에디터 로직
│       ├── HtmlEditor.svelte # 에디터 컴포넌트
│       └── HtmlRenderer.svelte
│
├── modules/                   # 도메인 특화 UI
│   └── editor/               # 에디터 UI 모듈
│       ├── EditOverlay.svelte     # 편집 모드 오버레이
│       └── SelectionOverlay.svelte # 선택 영역 오버레이
│
└── widgets/                   # 재사용 가능한 UI (준비중)
```

## 주요 변경 사항

### 1. Actions 레이어 신설
- **이유**: entities와 features 간 의존성 역전 문제 해결
- **효과**: 모든 레이어가 actions를 참조 가능한 깔끔한 구조
- **내용**: 
  - `entities/selection/actions.ts` → `actions/selection/index.ts`
  - 에디터 모드 액션들 → `actions/editor/mode.ts`

### 2. Entities 순수화
- **변경 전**: 타입, 스토어, 액션이 혼재
- **변경 후**: 타입과 스토어만 포함 (액션은 actions 레이어로)
- **장점**: 데이터 모델의 순수성 유지

### 3. EditMode 통합
- **변경 전**: `/lib/editModeStore.ts` (루트에 별도 존재)
- **변경 후**: `entities/editor/modeStore.ts` (editor 엔티티로 통합)
- **개선점**: 
  - storePath 활용으로 타입 안전성 향상
  - `'view' | 'edit' | 'select'` 모드 지원
  - 기존 boolean 방식과의 호환성 유지

### 4. UI 컴포넌트 정리
- **변경 전**: 루트에 산재한 .svelte 파일들
- **변경 후**: `modules/editor/`로 정리
- **정리된 파일**: EditOverlay.svelte, SelectionOverlay.svelte

## 의존성 구조

```
올바른 의존성 방향:
┌─────────────┐     ┌─────────────┐
│   modules   │ ──> │  features   │
└─────────────┘     └─────────────┘
       │                    │
       v                    v
┌─────────────┐     ┌─────────────┐
│   actions   │ <── │  entities   │
└─────────────┘     └─────────────┘

각 레이어의 역할:
- actions: 공유 이벤트 정의 (모든 레이어에서 import 가능)
- entities: 순수 데이터 모델과 상태 관리
- features: 비즈니스 로직 구현
- modules: 도메인 특화 UI 컴포넌트
- widgets: 재사용 가능한 UI 컴포넌트 (향후 구현)
```

## 성과

1. **명확한 관심사 분리**: 데이터/기능/화면/이벤트가 각각 독립적
2. **의존성 정리**: 순환 의존성 제거, 단방향 의존성 확립
3. **타입 안전성**: storePath 프록시로 경로 하드코딩 제거
4. **확장성**: 새로운 기능 추가 시 명확한 위치 결정 가능
5. **유지보수성**: 각 레이어의 책임이 명확하여 디버깅 용이

## 네이밍 컨벤션

- **Store 파일**: `*Store.ts` (PascalCase)
- **액션명**: 한글 사용, 언더스코어 prefix (`_선택하기`)
- **액션 타입**: `도메인.액션명` 형식 (`selection.선택하기`)
- **경로**: storePath 프록시 사용 (`storePath.editor.mode`)

## 향후 과제

1. **widgets 폴더 활용**: 재사용 가능한 UI 컴포넌트 추가
2. **features 강화**: 더 많은 비즈니스 로직 추가
3. **editor 엔티티 완성**: document, history 등 미구현 부분
4. **테스트 구조**: 각 레이어별 테스트 전략 수립

## 결론

데이터/기능/화면 3계층 분리와 actions 레이어 추가로 명확하고 확장 가능한 구조를 확립했습니다. 각 레이어의 책임이 명확해져 개발과 유지보수가 용이해졌으며, 타입 안전성도 크게 향상되었습니다.