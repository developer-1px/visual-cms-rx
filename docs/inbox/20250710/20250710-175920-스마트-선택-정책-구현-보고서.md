# 스마트 선택 정책 구현 보고서

> 현재 선택한 항목이 repeat인 경우 일반적인 경우라면 다른 repeat를 선택하려고 할 이유가 높아. 그런데 text나 아이콘을 누르게 되면 스트레스를 받지 그래서 현재 선택된 항목에 따라 같은 항목을 더 우선할 수 있는 정책을 구현하려고 해

## 요구사항 분석

### 문제 상황
- 사용자가 repeat 항목을 편집하는 워크플로우에서 실수로 다른 타입(text, icon)을 클릭하는 경우
- 의도하지 않은 선택으로 인한 작업 흐름 방해 및 사용자 스트레스 발생

### 해결 목표
현재 선택된 타입과 같은 타입의 요소를 우선적으로 선택하는 스마트 선택 정책 구현

## 구현된 해결책

### 스마트 선택 정책 로직

```typescript
// 1. 클릭 지점의 모든 편집 가능한 요소 수집
const selectableElements = elements.filter(el => 
  el instanceof HTMLElement && el.hasAttribute('data-editable')
) as HTMLElement[];

// 2. 현재 선택된 요소의 타입 확인
const currentSelectedType = selectedId ? 
  document.querySelector(`[data-node-id="${selectedId}"]`)?.getAttribute('data-editable') : null;

// 3. 스마트 선택 적용
if (currentSelectedType) {
  // 같은 타입의 요소가 있으면 우선 선택
  const sameTypeElement = selectableElements.find(el => 
    el.getAttribute('data-editable') === currentSelectedType
  );
  selectable = sameTypeElement || selectableElements[0];
} else {
  // 현재 선택된 요소가 없으면 가장 가까운 요소 선택
  selectable = selectableElements[0];
}
```

### 작동 방식

1. **현재 선택된 타입이 있는 경우**:
   - `elementsFromPoint`로 얻은 모든 후보 중에서 같은 타입 우선 선택
   - 같은 타입이 없으면 기존 방식대로 가장 가까운 요소 선택

2. **현재 선택된 타입이 없는 경우**:
   - 기존 방식 유지 (가장 가까운 요소 선택)

## 사용자 경험 개선 효과

### Before (기존 방식)
```
현재 선택: repeat 항목
클릭 후보: [text, icon, repeat]
결과: text 선택 (가장 가까운 요소) → 사용자 스트레스
```

### After (스마트 선택 정책)
```
현재 선택: repeat 항목  
클릭 후보: [text, icon, repeat]
결과: repeat 선택 (같은 타입 우선) → 자연스러운 워크플로우
```

## 적용 시나리오

### 1. Repeat 편집 워크플로우
- Features 섹션에서 repeat 카드들 간 이동 시 자연스러운 선택
- Integrations 섹션에서 아이콘들 간 이동 시 자연스러운 선택
- Solutions 섹션에서 솔루션 카드들 간 이동 시 자연스러운 선택

### 2. Text 편집 워크플로우  
- 제목, 본문 텍스트 편집 시 다른 텍스트 요소로 자연스럽게 이동

### 3. Icon 편집 워크플로우
- SVG 아이콘들 간 선택 시 우선순위 적용

## 기술적 구현 세부사항

### 파일 위치
- `src/lib/modules/editor/EditOverlay.svelte`의 `handleOverlayClick` 함수

### 핵심 변경사항
1. **다중 후보 수집**: `find` → `filter`로 변경하여 모든 선택 가능한 요소 수집
2. **타입 기반 우선순위**: 현재 선택된 타입과 일치하는 요소 우선 선택
3. **폴백 메커니즘**: 같은 타입이 없으면 기존 방식으로 폴백

### 성능 고려사항
- 추가적인 DOM 조회가 발생하지만 선택 시에만 실행되므로 성능 영향 최소
- `querySelector` 사용으로 현재 선택된 요소의 타입 확인

## 검증 및 테스트

### 테스트 시나리오
1. **repeat → repeat 선택**: Features 카드에서 다른 Features 카드로 이동
2. **repeat → text 의도적 선택**: repeat 선택 중 제목 텍스트 클릭 시 정상 작동
3. **text → text 선택**: 제목에서 본문으로 텍스트 간 이동
4. **초기 선택**: 아무것도 선택되지 않은 상태에서 정상 작동

### 빌드 결과
- ✅ 빌드 성공 (pnpm build)
- ✅ 기존 기능 유지
- ✅ 새로운 스마트 선택 정책 적용

## 향후 개선 가능성

### 1. 설정 가능성
- 사용자가 스마트 선택 정책을 켜고 끌 수 있는 토글 기능

### 2. 시각적 피드백
- 스마트 선택이 적용되었을 때 미묘한 시각적 힌트 제공

### 3. 세부 타입 구분
- repeat 내에서 feature-repeat, integration-repeat 등으로 세분화

### 4. 우선순위 세부 조정
- 거리 기반 가중치 추가 고려

## 결론

스마트 선택 정책 구현으로 사용자의 의도를 더 정확하게 파악하여 자연스러운 편집 워크플로우를 제공할 수 있게 되었습니다. 특히 repeat 항목 편집 시 발생하던 사용자 스트레스를 크게 줄일 수 있을 것으로 예상됩니다.

---

**구현 일시**: 2025-01-10 17:59:20  
**구현자**: Claude Code Assistant  
**영향 범위**: EditOverlay 선택 로직  
**테스트 상태**: 빌드 검증 완료